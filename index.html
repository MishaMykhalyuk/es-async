<!doctype html>
<html lang="ru">
<head>
	<meta charset="utf-8">
	<title>ES async programming</title>
	<link rel="stylesheet" href="node_modules/shower-ribbon/styles/screen-16x10.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/default.min.css">
	<link rel="stylesheet" href="styles.css">
</head>
<body class="shower list">

	<header class="caption">
		<h1>Асинхронний JavaScript</h1>
		<p>Михайло Михалюк</p>
	</header>

	<section class="slide white">
		<h2 class="shout">Асинхронний JavaScript</h2>
	</section>

	<section class="slide white">
		<h2><code>whoami</code></h2>

		<ul>
			<li>3+ роки пишу продакшн JavaScript</li>
			<li>Розробник у <a href="https://viseven.com/">Viseven</a></li>
		</ul>
	</section>

	<section class="slide white">
		<h2>How does JavaScript actually work?</h2>
		<img src="./media/js.png" style="margin: auto; display: block; width: 800px;">
	</section>


	<section class="slide white middle-padding">
		<h2>Call stack</h2>

		<div class="justify-double">
			<div class="code">
				<pre>
					<div>					
						<code>function multiply(a, b) {</code>
						<code>	return a * b;</code>
						<code>}</code>
					</div>
					<div>						
						<code>function square(n) {</code>
						<code>	return n * n;</code>
						<code>}</code>
					</div>
					<div>					
						<code>function printSquare(n) {</code>
						<code>  const squared = square(n);</code>
						<code>  console.log(scuared)</code>
						<code>}</code>
					</div>
					<code>printSquare(4);</code>
				</pre>
			</div>
			<div class="stack">
				<h3>stack</h3>
				<div class="stack-box">
					<div class="execution-block">
						<p>main()</p>
					</div>
				</div>
			</div>
		</div>
	</section>

	<section class="slide white middle-padding">
		<h2>Call stack</h2>

		<div class="justify-double">
			<div class="code">
				<pre>
					<div>					
						<code>function multiply(a, b) {</code>
						<code>	return a * b;</code>
						<code>}</code>
					</div>
					<div>						
						<code>function square(n) {</code>
						<code>	return n * n;</code>
						<code>}</code>
					</div>
					<div class="processing-code">					
						<code>function printSquare(n) {</code>
						<code>  const squared = square(n);</code>
						<code>  console.log(scuared)</code>
						<code>}</code>
					</div>
					<code>printSquare(4);</code>
				</pre>
			</div>
			<div class="stack">
				<h3>stack</h3>
				<div class="stack-box">
					<div class="execution-block">
						<p>main()</p>
					</div>
					<div class="execution-block">
						<p>printSquare(4)</p>
					</div>
				</div>
			</div>
		</div>
	</section>

	<section class="slide white middle-padding">
		<h2>Call stack</h2>

		<div class="justify-double">
			<div class="code">
				<pre>
					<div>					
						<code>function multiply(a, b) {</code>
						<code>	return a * b;</code>
						<code>}</code>
					</div>
					<div class="processing-code">
						<code>function square(n) {</code>
						<code>	return n * n;</code>
						<code>}</code>
					</div>
					<div class="processing-code">					
						<code>function printSquare(n) {</code>
						<code>  const squared = square(n);</code>
						<code>  console.log(scuared)</code>
						<code>}</code>
					</div>
					<code>printSquare(4);</code>
				</pre>
			</div>
			<div class="stack">
				<h3>stack</h3>
				<div class="stack-box">
					<div class="execution-block">
						<p>main()</p>
					</div>
					<div class="execution-block">
						<p>printSquare(4)</p>
					</div>
					<div class="execution-block">
						<p>square(n)</p>
					</div>
				</div>
			</div>
		</div>
	</section>

	<section class="slide white middle-padding">
		<h2>Call stack</h2>

		<div class="justify-double">
			<div class="code">
				<pre>
					<div class="processing-code">					
						<code>function multiply(a, b) {</code>
						<code>	return a * b;</code>
						<code>}</code>
					</div>
					<div class="processing-code">
						<code>function square(n) {</code>
						<code>	return n * n;</code>
						<code>}</code>
					</div>
					<div class="processing-code">					
						<code>function printSquare(n) {</code>
						<code>  const squared = square(n);</code>
						<code>  console.log(scuared)</code>
						<code>}</code>
					</div>
					<code>printSquare(4);</code>
				</pre>
			</div>
			<div class="stack">
				<h3>stack</h3>
				<div class="stack-box">
					<div class="execution-block">
						<p>main()</p>
					</div>
					<div class="execution-block">
						<p>printSquare(4)</p>
					</div>
					<div class="execution-block">
						<p>square(n)</p>
					</div>
					<div class="execution-block">
						<p>multiply(n, n)</p>
					</div>
				</div>
			</div>
		</div>
	</section>

	<section class="slide white middle-padding">
		<h2>Call stack</h2>

		<div class="justify-double">
			<div class="code">
				<pre>
					<div>					
						<code>function multiply(a, b) {</code>
						<code>	return a * b;</code>
						<code>}</code>
					</div>
					<div class="processing-code">
						<code>function square(n) {</code>
						<code>	return n * n;</code>
						<code>}</code>
					</div>
					<div class="processing-code">					
						<code>function printSquare(n) {</code>
						<code>  const squared = square(n);</code>
						<code>  console.log(scuared)</code>
						<code>}</code>
					</div>
					<code>printSquare(4);</code>
				</pre>
			</div>
			<div class="stack">
				<h3>stack</h3>
				<div class="stack-box">
					<div class="execution-block">
						<p>main()</p>
					</div>
					<div class="execution-block">
						<p>printSquare(4)</p>
					</div>
					<div class="execution-block">
						<p>square(n)</p>
					</div>
				</div>
			</div>
		</div>
	</section>

	<section class="slide white middle-padding">
		<h2>Call stack</h2>

		<div class="justify-double">
			<div class="code">
				<pre>
					<div>					
						<code>function multiply(a, b) {</code>
						<code>	return a * b;</code>
						<code>}</code>
					</div>
					<div>						
						<code>function square(n) {</code>
						<code>	return n * n;</code>
						<code>}</code>
					</div>
					<div class="processing-code">					
						<code>function printSquare(n) {</code>
						<code>  const squared = square(n);</code>
						<code>  console.log(scuared)</code>
						<code>}</code>
					</div>
					<code>printSquare(4);</code>
				</pre>
			</div>
			<div class="stack">
				<h3>stack</h3>
				<div class="stack-box">
					<div class="execution-block">
						<p>main()</p>
					</div>
					<div class="execution-block">
						<p>printSquare(4)</p>
					</div>
				</div>
			</div>
		</div>
	</section>

	<section class="slide white middle-padding">
		<h2>Call stack</h2>

		<div class="justify-double">
			<div class="code">
				<pre>
					<div>					
						<code>function multiply(a, b) {</code>
						<code>	return a * b;</code>
						<code>}</code>
					</div>
					<div>						
						<code>function square(n) {</code>
						<code>	return n * n;</code>
						<code>}</code>
					</div>
					<div class="processing-code">					
						<code>function printSquare(n) {</code>
						<code>  const squared = square(n);</code>
						<code>  console.log(scuared)</code>
						<code>}</code>
					</div>
					<code>printSquare(4);</code>
				</pre>
			</div>
			<div class="stack">
				<h3>stack</h3>
				<div class="stack-box">
					<div class="execution-block">
						<p>main()</p>
					</div>
					<div class="execution-block">
						<p>printSquare(4)</p>
					</div>
					<div class="execution-block">
						<p>console.log(squared)</p>
					</div>
				</div>
			</div>
		</div>
	</section>

	<section class="slide white middle-padding">
		<h2>Call stack</h2>

		<div class="justify-double">
			<div class="code">
				<pre>
					<div>					
						<code>function multiply(a, b) {</code>
						<code>	return a * b;</code>
						<code>}</code>
					</div>
					<div>						
						<code>function square(n) {</code>
						<code>	return n * n;</code>
						<code>}</code>
					</div>
					<div class="processing-code">					
						<code>function printSquare(n) {</code>
						<code>  const squared = square(n);</code>
						<code>  console.log(scuared)</code>
						<code>}</code>
					</div>
					<code>printSquare(4);</code>
				</pre>
			</div>
			<div class="stack">
				<h3>stack</h3>
				<div class="stack-box">
					<div class="execution-block">
						<p>main()</p>
					</div>
					<div class="execution-block">
						<p>printSquare(4)</p>
					</div>
				</div>
			</div>
		</div>
	</section>

	<section class="slide white middle-padding">
		<h2>Call stack</h2>

		<div class="justify-double">
			<div class="code">
				<pre>
					<div>					
						<code>function multiply(a, b) {</code>
						<code>	return a * b;</code>
						<code>}</code>
					</div>
					<div>						
						<code>function square(n) {</code>
						<code>	return n * n;</code>
						<code>}</code>
					</div>
					<div>					
						<code>function printSquare(n) {</code>
						<code>  const squared = square(n);</code>
						<code>  console.log(scuared)</code>
						<code>}</code>
					</div>
					<code>printSquare(4);</code>
				</pre>
			</div>
			<div class="stack">
				<h3>stack</h3>
				<div class="stack-box">
					<div class="execution-block">
						<p>main()</p>
					</div>
				</div>
			</div>
		</div>
	</section>

	<section class="slide white middle-padding">
		<h2>Call stack</h2>

		<div class="justify-double">
			<div class="code">
				<pre>
					<div>					
						<code>function multiply(a, b) {</code>
						<code>	return a * b;</code>
						<code>}</code>
					</div>
					<div>						
						<code>function square(n) {</code>
						<code>	return n * n;</code>
						<code>}</code>
					</div>
					<div>					
						<code>function printSquare(n) {</code>
						<code>  const squared = square(n);</code>
						<code>  console.log(scuared)</code>
						<code>}</code>
					</div>
					<code>printSquare(4);</code>
				</pre>
			</div>
			<div class="stack">
				<h3>stack</h3>
				<div class="stack-box"></div>
			</div>
		</div>
	</section>

	<section class="slide white middle-padding">
		<h2>Call stack</h2>

		<div class="justify-double">
			<div class="code">
				<pre>
					<code>function foo() {</code>
					<code>	throw new Error('Oops!');</code>
					<code>}</code>
					<code>function bar() {</code>
					<code>	foo();</code>
					<code>}</code>
					<code>function baz() {</code>
					<code>  bar();</code>
					<code>}</code>
					<code>baz();</code>
				</pre>
			</div>
			<div style="display: flex;">
				<img src="./media/err.png" style="margin: auto; height: 100px width: 490px">
			</div>
		</div>
	</section>

	<section class="slide white middle-padding">
		<h2>Call stack</h2>

		<div class="justify-double">

			<div>
				<div class="code">
					<div class="outer">
						<div class="inner next">
							<div class="exec" style="bottom: 64px">
								<p>foo()</p>
							</div>
							<div class="inner next">
								<div class="exec" style="bottom: 130px">
									<p>foo()</p>
								</div>
								<div class="inner next">
									<div class="exec" style="bottom: 196px">
										<p>foo()</p>
									</div>
									<div class="inner next">
										<div class="exec" style="bottom: 262px">
											<p>foo()</p>
										</div>
										<div class="inner next">
											<div class="exec" style="bottom: 328px">
												<p>foo()</p>
											</div>
											<div class="inner next">
												<div class="exec" style="bottom: 394px">
													<p>foo()</p>
												</div>
												<div class="inner next">
													<div class="exec" style="bottom: 462px">
														<p>foo()</p>
													</div>
													<div class="inner next">
															<div class="exec" style="bottom: 528px">
														<p>foo()</p>
													</div>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>

					<pre class="exceeded">
						<div>					
							<code>function foo() {</code>
							<code>	return foo();</code>
							<code>}</code>
						</div>
					</pre>
					<pre style="position: absolute; left: 200px;">
						<code>foo();</code>
					</pre>

					<img class="next exceeded-err" src="./media/exceeded.png">
			</div>
			</div>

			<div class="stack">
				<h3>stack</h3>
				<div class="stack-box"></div>
			</div>
		</div>
	</section>

	<section class="slide">
		<h2>Blocking</h2>
	</section>

	<section class="slide white">
		<h2>Side effects</h2>
		<ul>
			<li>HTTP requests</li>
			<li>File system</li>
			<li>Timers</li>
			<li>Events</li>
			<li>Workers</li>
			<li>...</li>
		</ul>
	</section>

	<section class="slide white">
		<h2>Asynchronous programming</h2>
		<p>Тип <mark>паралельних</mark> обчислень, який передбачає, що операція може бути виконана кимось на стороні, за межами поточного обчислювального пристрою.</p>
		<p class="next">Можна виконувати кілька асинхронних операцій <mark>одночасно</mark>.</p>
		<p class="next">Результат роботи потрібно <mark>чекати</mark>.</p>
	</section>

	<section class="slide white">
		<h2 class="shout middle">How is JavaScript asynchronous <mark>and</mark> single threaded?</h2>
	</section>

	<section class="slide white">
		<h2 class="shout middle"><i>"Everything runs on a different thread except our code"</i></h2>
	</section>

	<section class="slide white">
		<h2>The browser is more than just runtime</h2>
		<img src="./media/js.png" style="margin: auto; display: block; width: 800px;">
	</section>

	<section class="slide white">
		<h2>Loupe (async)</h2>
	</section>

	<section class="slide white">
		<h2 class="shout middle">How do we do it?</h2>
	</section>

	<section class="slide white">
		<img src="./media/callback-hell.png" class="cover w">
	</section>

	<section class="slide white">
		<img src="./media/callback.gif" class="cover w">
	</section>

	<section class="slide white">
		<h2 class="shout middle">Promises</h2>
	</section>

	<section class="slide white">
		<div class="justify-double code-style">
		<div>
			<p>Callback</p>			
			<pre>
				<code>createUser(name, function () {  </code>
				<code> getFriends(name, function (friends) {</code>
				<code>  if (friends) {</code>
				<code>   invite(friends, function (invites) {</code>
				<code>    // ad infinitum</code>
				<code>   });</code>
				<code>  };</code>
				<code> });</code>
				<code>});</code>
			</pre>
		</div>
		<div>
			<p>Promise</p>
			<pre>
				<code>createUser(name)  </code>
				<code>  .then(getFriends)</code>
				<code>  .then(function (friends) {</code>
				<code>    if (friends) {</code>
				<code>      return invite(friends);</code>
				<code>    } else {</code>
				<code>      throw new Error('No friends to invite');</code>
				<code>    }</code>
				<code>  })</code>
				<code>  .catch(displayError);</code>
			</pre>
		</div>
		</div>
	</section>

 	<section class="slide white">
	 	<h2>Promise chaining</h2>
		<pre>
				<code>createUser(name)  </code>
				<code>  .then(getFriends)</code>
				<code>  .then(invite)</code>
				<code>  .catch(displayError);</code>
			</pre>
	</section>

 	<section class="slide white">
		<h2>Антипатерни та складності</h2>
		<ul>
			<li>Це все ще callback'и</li>
			<li>Досі є задачі, в яких доводиться писати вкладені проміси</li>
			<li>Складно писати <mark>правильно</mark></li>
		</ul>
	</section>

 	<section class="slide white">
		
	</section>

 	<section class="slide white full">
		<!-- <iframe class="loup" src="./loupe-js/index.html"></iframe> -->
	</section>

	<script src="node_modules/shower-core/shower.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script>
	<script>hljs.initHighlightingOnLoad();</script>
</body>
</html>
